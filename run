#!/usr/bin/env python3
"""
ONE SIMPLE COMMAND TO RUN EVERYTHING
Auto-detects configuration and starts agents
"""

import os
import sys
import subprocess
from pathlib import Path

PROJECT_ROOT = Path(__file__).parent

def check_and_setup():
    """Check if setup is needed, prompt if not configured."""
    config_path = PROJECT_ROOT / "config.yaml"
    
    # Check if system is configured
    if not config_path.exists():
        print("\n‚ö†Ô∏è  First time setup needed")
        print("   Run: ./setup_proper.py\n")
        sys.exit(0)
    
    # Check if config is valid
    try:
        import yaml
        with open(config_path, 'r') as f:
            config = yaml.safe_load(f)
            agent_models = config.get('agent_models', {})
            if len(agent_models) < 23:
                print("\n‚ö†Ô∏è  Configuration incomplete")
                print("   Run: ./setup_proper.py\n")
                sys.exit(0)
    except:
        print("\n‚ö†Ô∏è  Configuration invalid")
        print("   Run: ./setup_proper.py\n")
        sys.exit(0)
    
    print("ü§ñ Starting up...")
    
    # Setup venv if needed
    venv_path = PROJECT_ROOT / "venv"
    if not venv_path.exists():
        print("\n‚ö†Ô∏è  Virtual environment missing")
        print("   Run: ./setup_proper.py\n")
        sys.exit(0)
    
    print("‚úÖ Ready!\n")
    return venv_path

def main():
    """Main entry"""
    try:
        # Setup
        venv_path = check_and_setup()
        
        # Launch with venv Python
        python_exe = venv_path / "bin" / "python3"
        orchestrator = PROJECT_ROOT / "orchestrator_v2.py"
        
        print("üöÄ Launching AI Dev Team...\n")
        subprocess.run([str(python_exe), str(orchestrator)])
        
    except KeyboardInterrupt:
        print("\n\nGoodbye!")
    except Exception as e:
        print(f"\n‚ùå Error: {e}")
        print("\nTry running: ./fix_setup.sh")
        sys.exit(1)

if __name__ == "__main__":
    main()
